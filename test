name: Toggle Maintenance Banner

on:
  workflow_dispatch:
    inputs:
      enable_banner:
        description: 'Enable maintenance banner (true/false)'
        required: true
        default: 'true'

jobs:
  toggle-banner:
    runs-on: ubuntu-latest

    steps:
    - name: Decode Kubeconfig
      run: echo "${{ secrets.KUBE_CONFIG }}" | base64 -d > kubeconfig

    - name: Install kubectl
      uses: azure/setup-kubectl@v3

    - name: Update maintenance-banner ConfigMap
      run: |
        export KUBECONFIG=kubeconfig
        if [ "${{ github.event.inputs.enable_banner }}" = "true" ]; then
          kubectl -n ${{ secrets.KUBE_NAMESPACE }} patch configmap maintenance-banner --type merge -p '{"data":{"enable_maintenance.flag":"true"}}'
        else
          kubectl -n ${{ secrets.KUBE_NAMESPACE }} patch configmap maintenance-banner --type merge -p '{"data":{"enable_maintenance.flag":""}}'
        fi

    - name: Restart Deployment to re-mount ConfigMap
      run: |
        kubectl -n ${{ secrets.KUBE_NAMESPACE }} rollout restart deployment angular-nginx-app
